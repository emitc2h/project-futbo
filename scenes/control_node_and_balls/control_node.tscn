[gd_scene load_steps=23 format=3 uid="uid://cupvg7lj3rh2s"]

[ext_resource type="PackedScene" uid="uid://dnw8l88q5vgm3" path="res://scenes/control_node_and_balls/ball_base.tscn" id="1_fpwqj"]
[ext_resource type="Script" uid="uid://8s2wdi5le4ti" path="res://scripts/control_node_and_balls/control_node.gd" id="2_r7e0p"]
[ext_resource type="Script" uid="uid://bhy7it06w5oxr" path="res://addons/godot_state_charts/compound_state.gd" id="3_02qb1"]
[ext_resource type="Script" uid="uid://bpu4om7fscq8" path="res://scripts/control_node_and_balls/states/control_node_control_states.gd" id="3_qi4cr"]
[ext_resource type="Script" uid="uid://b2onxl0bnlyi7" path="res://addons/godot_state_charts/atomic_state.gd" id="4_0jkta"]
[ext_resource type="PackedScene" uid="uid://caxwuwjjre3j2" path="res://scenes/control_node_and_balls/direction_ray.tscn" id="4_bt07l"]
[ext_resource type="Script" uid="uid://t3jmyqr06q1w" path="res://scripts/control_node_and_balls/states/control_node_power_states.gd" id="4_qi4cr"]
[ext_resource type="Script" uid="uid://g3cjsxu4h2a2" path="res://addons/godot_state_charts/transition.gd" id="5_qi4cr"]
[ext_resource type="Script" uid="uid://b3jcml15v3wkh" path="res://scripts/control_node_and_balls/states/control_node_charge_states.gd" id="6_8s4nh"]
[ext_resource type="PackedScene" uid="uid://bkp8fbjsyyhyx" path="res://scenes/control_node_and_balls/assets/control_node_asset.tscn" id="7_2p3vg"]
[ext_resource type="PackedScene" uid="uid://dvd5ic7fxna84" path="res://scenes/control_node_and_balls/models/control_node_streak.tscn" id="11_8s4nh"]
[ext_resource type="Texture2D" uid="uid://cmy0jxny0n8xx" path="res://assets/3D/Particles/dots/mega_dot_color.png" id="11_r313a"]
[ext_resource type="ArrayMesh" uid="uid://b3lvlj7kfxj60" path="res://assets/3D/Particles/lightning-sparks/lightning_on_sphere_mesh.tres" id="12_cnds4"]
[ext_resource type="PackedScene" uid="uid://dr3wkl0fgpbyw" path="res://scenes/control_node_and_balls/models/control_node_ready_sphere.tscn" id="13_nbe53"]

[sub_resource type="Curve" id="Curve_r313a"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.708835, 0.64441), -1.77206, -1.77206, 0, 0, Vector2(0.953815, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_cnds4"]
curve = SubResource("Curve_r313a")

[sub_resource type="Curve" id="Curve_l8rvj"]
_limits = [0.0, 2.0, 0.0, 1.0]
_data = [Vector2(0, 2), 0.0, 0.0, 0, 0, Vector2(0.638554, 1.58478), -1.94736, -1.94736, 0, 0, Vector2(0.859438, 0.975195), -3.7456, -3.7456, 0, 0, Vector2(1, 0), -13.2928, 0.0, 0, 0]
point_count = 4

[sub_resource type="CurveTexture" id="CurveTexture_uxj54"]
curve = SubResource("Curve_l8rvj")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_1t0mc"]
lifetime_randomness = 1.0
particle_flag_rotate_y = true
emission_shape = 2
emission_sphere_radius = 0.14
direction = Vector3(0, 0, 0)
angular_velocity_min = -1.60933e-05
angular_velocity_max = -1.60933e-05
radial_velocity_min = 0.799978
radial_velocity_max = 1.19998
gravity = Vector3(0, 0, 0)
radial_accel_min = -2.0
radial_accel_max = -2.0
tangential_accel_min = -0.600002
tangential_accel_max = 0.599998
attractor_interaction_enabled = false
scale_curve = SubResource("CurveTexture_uxj54")
color = Color(1, 0, 1, 1)
alpha_curve = SubResource("CurveTexture_cnds4")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_jasuo"]
transparency = 1
vertex_color_use_as_albedo = true
albedo_color = Color(1, 0, 1, 1)
albedo_texture = ExtResource("11_r313a")
emission_enabled = true
emission = Color(0.929549, 0.6567, 1, 1)
emission_intensity = 50000.0
billboard_keep_scale = true

[sub_resource type="QuadMesh" id="QuadMesh_ygoor"]
material = SubResource("StandardMaterial3D_jasuo")
size = Vector2(0.015, 0.015)

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_xdpkx"]
particle_flag_align_y = true
angle_min = -261.7
angle_max = 103.2
radial_velocity_min = -2.23517e-05
radial_velocity_max = 0.00997765
gravity = Vector3(0, 0, 0)
attractor_interaction_enabled = false
scale_min = 0.6
scale_max = 0.6

[node name="ControlNode" node_paths=PackedStringArray("power_states", "charge_states", "asset") instance=ExtResource("1_fpwqj")]
script = ExtResource("2_r7e0p")
power_states = NodePath("State/Root/Power/Power States")
charge_states = NodePath("State/Root/Charge/Charge States")
asset = NodePath("TrackTransformContainer/ControlNodeAsset")

[node name="State" parent="." index="0"]
track_in_editor = true

[node name="Control States" parent="State/Root/Control" index="0" node_paths=PackedStringArray("streak")]
script = ExtResource("3_qi4cr")
shot_speed = 50.0
range = 10.0
streak = NodePath("../../../../ControlNodeStreak")

[node name="to shot" type="Node" parent="State/Root/Control/free" index="2"]
script = ExtResource("5_qi4cr")
to = NodePath("../../shot")
event = &"Control: free to shot"
delay_in_seconds = "0.0"

[node name="shot" type="Node" parent="State/Root/Control" index="4"]
script = ExtResource("4_0jkta")

[node name="to free" type="Node" parent="State/Root/Control/shot" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../free")
event = &"Control: shot to free"
delay_in_seconds = "0.0"

[node name="Power" type="Node" parent="State/Root" index="2"]
script = ExtResource("3_02qb1")
initial_state = NodePath("off")

[node name="Power States" type="Node" parent="State/Root/Power" index="0" node_paths=PackedStringArray("control_node", "asset", "sc", "direction_ray", "rigid_node")]
script = ExtResource("4_qi4cr")
control_node = NodePath("../../../..")
asset = NodePath("../../../../TrackTransformContainer/ControlNodeAsset")
sc = NodePath("../../..")
direction_ray = NodePath("../../../../TrackPositionContainer/DirectionRay")
rigid_node = NodePath("../../../../RigidNode")

[node name="off" type="Node" parent="State/Root/Power" index="1"]
script = ExtResource("4_0jkta")

[node name="to charging" type="Node" parent="State/Root/Power/off" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../charging")
event = &"Power: off to charging"
delay_in_seconds = "0.0"

[node name="charging" type="Node" parent="State/Root/Power" index="2"]
script = ExtResource("4_0jkta")

[node name="to on" type="Node" parent="State/Root/Power/charging" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../on")
event = &"Power: charging to on"
delay_in_seconds = "0.0"

[node name="on" type="Node" parent="State/Root/Power" index="3"]
script = ExtResource("4_0jkta")

[node name="to off" type="Node" parent="State/Root/Power/on" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../off")
event = &"Power: to off"
delay_in_seconds = "0.0"

[node name="to expanded" type="Node" parent="State/Root/Power/on" index="1"]
script = ExtResource("5_qi4cr")
to = NodePath("../../expanded")
event = &"Power: to expanded"
delay_in_seconds = "0.0"

[node name="bounce" type="Node" parent="State/Root/Power/on" index="2"]
script = ExtResource("5_qi4cr")
to = NodePath("..")
event = &"Power: bounce"
delay_in_seconds = "0.0"

[node name="hit" type="Node" parent="State/Root/Power/on" index="3"]
script = ExtResource("5_qi4cr")
to = NodePath("..")
event = &"Power: hit"
delay_in_seconds = "0.0"

[node name="blow" type="Node" parent="State/Root/Power/on" index="4"]
script = ExtResource("5_qi4cr")
to = NodePath("../../off")
event = &"Power: blow"
delay_in_seconds = "0.0"

[node name="expanded" type="Node" parent="State/Root/Power" index="4"]
script = ExtResource("4_0jkta")

[node name="to on" type="Node" parent="State/Root/Power/expanded" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../on")
event = &"shrink shield"
delay_in_seconds = "0.0"

[node name="Charge" type="Node" parent="State/Root" index="3"]
script = ExtResource("3_02qb1")
initial_state = NodePath("none")

[node name="Charge States" type="Node" parent="State/Root/Charge" index="0" node_paths=PackedStringArray("control_node", "rigid_node", "asset", "sc")]
script = ExtResource("6_8s4nh")
control_node = NodePath("../../../..")
rigid_node = NodePath("../../../../RigidNode")
asset = NodePath("../../../../TrackTransformContainer/ControlNodeAsset")
sc = NodePath("../../..")

[node name="none" type="Node" parent="State/Root/Charge" index="1"]
script = ExtResource("4_0jkta")

[node name="to level1" type="Node" parent="State/Root/Charge/none" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../level1")
event = &"charge up"
delay_in_seconds = "0.0"

[node name="level1" type="Node" parent="State/Root/Charge" index="2"]
script = ExtResource("4_0jkta")

[node name="to none" type="Node" parent="State/Root/Charge/level1" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../none")
event = &"discharge"
delay_in_seconds = "0.0"

[node name="to level2" type="Node" parent="State/Root/Charge/level1" index="1"]
script = ExtResource("5_qi4cr")
to = NodePath("../../level2")
event = &"charge up"
delay_in_seconds = "0.0"

[node name="level2" type="Node" parent="State/Root/Charge" index="3"]
script = ExtResource("4_0jkta")

[node name="to none" type="Node" parent="State/Root/Charge/level2" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../none")
event = &"discharge"
delay_in_seconds = "0.0"

[node name="to level3" type="Node" parent="State/Root/Charge/level2" index="1"]
script = ExtResource("5_qi4cr")
to = NodePath("../../level3")
event = &"charge up"
delay_in_seconds = "0.0"

[node name="level3" type="Node" parent="State/Root/Charge" index="4"]
script = ExtResource("4_0jkta")

[node name="to none" type="Node" parent="State/Root/Charge/level3" index="0"]
script = ExtResource("5_qi4cr")
to = NodePath("../../none")
event = &"discharge"
delay_in_seconds = "0.0"

[node name="ControlNodeAsset" parent="TrackTransformContainer" index="0" node_paths=PackedStringArray("wisps_particles", "lightning_particles", "ready_sphere") instance=ExtResource("7_2p3vg")]
wisps_particles = NodePath("../../TrackPositionContainer/WispParticles3D")
lightning_particles = NodePath("../../TrackPositionContainer/LightningParticles3D")
ready_sphere = NodePath("../../TrackPositionContainer/ControlNodeReadySphere")

[node name="DirectionRay" parent="TrackPositionContainer" index="0" instance=ExtResource("4_bt07l")]

[node name="GPUParticlesAttractorSphere3D" type="GPUParticlesAttractorSphere3D" parent="TrackPositionContainer" index="1"]
strength = 65.0
attenuation = 2.0
radius = 10.0

[node name="GPUParticlesCollisionSphere3D" type="GPUParticlesCollisionSphere3D" parent="TrackPositionContainer" index="2"]

[node name="WispParticles3D" type="GPUParticles3D" parent="TrackPositionContainer" index="3"]
emitting = false
amount = 200
lifetime = 1.2
one_shot = true
explosiveness = 1.0
randomness = 0.34
fixed_fps = 60
local_coords = true
trail_lifetime = 1.0
process_material = SubResource("ParticleProcessMaterial_1t0mc")
draw_pass_1 = SubResource("QuadMesh_ygoor")

[node name="LightningParticles3D" type="GPUParticles3D" parent="TrackPositionContainer" index="4"]
amount = 10
amount_ratio = 0.1
local_coords = true
process_material = SubResource("ParticleProcessMaterial_xdpkx")
draw_pass_1 = ExtResource("12_cnds4")

[node name="ControlNodeReadySphere" parent="TrackPositionContainer" index="5" instance=ExtResource("13_nbe53")]

[node name="ControlNodeStreak" parent="." index="5" instance=ExtResource("11_8s4nh")]

[connection signal="state_entered" from="State/Root/Control/dribbled" to="State/Root/Power/Power States" method="_on_control_states_dribbled_state_entered"]
[connection signal="state_entered" from="State/Root/Control/shot" to="State/Root/Control/Control States" method="_on_shot_state_entered"]
[connection signal="state_exited" from="State/Root/Control/shot" to="State/Root/Control/Control States" method="_on_shot_state_exited"]
[connection signal="state_physics_processing" from="State/Root/Control/shot" to="State/Root/Control/Control States" method="_on_shot_state_physics_processing"]
[connection signal="state_entered" from="State/Root/Power/off" to="State/Root/Power/Power States" method="_on_off_state_entered"]
[connection signal="state_entered" from="State/Root/Power/charging" to="State/Root/Power/Power States" method="_on_charging_state_entered"]
[connection signal="state_entered" from="State/Root/Power/on" to="State/Root/Power/Power States" method="_on_on_state_entered"]
[connection signal="state_exited" from="State/Root/Power/on" to="State/Root/Power/Power States" method="_on_on_state_exited"]
[connection signal="state_physics_processing" from="State/Root/Power/on" to="State/Root/Power/Power States" method="_on_on_state_physics_processing"]
[connection signal="taken" from="State/Root/Power/on/to off" to="State/Root/Power/Power States" method="_on_on_to_off_taken"]
[connection signal="taken" from="State/Root/Power/on/to expanded" to="State/Root/Power/Power States" method="_on_on_to_expanded_taken"]
[connection signal="taken" from="State/Root/Power/on/bounce" to="State/Root/Power/Power States" method="_on_on_to_bounce_taken"]
[connection signal="taken" from="State/Root/Power/on/hit" to="State/Root/Power/Power States" method="_on_on_to_hit_taken"]
[connection signal="taken" from="State/Root/Power/on/blow" to="State/Root/Power/Power States" method="_on_on_to_blow_taken"]
[connection signal="state_entered" from="State/Root/Power/expanded" to="State/Root/Power/Power States" method="_on_expanded_state_entered"]
[connection signal="state_exited" from="State/Root/Power/expanded" to="State/Root/Power/Power States" method="_on_expanded_state_exited"]
[connection signal="state_physics_processing" from="State/Root/Power/expanded" to="State/Root/Power/Power States" method="_on_expanded_state_physics_processing"]
[connection signal="state_entered" from="State/Root/Charge/none" to="State/Root/Charge/Charge States" method="_on_none_state_entered"]
[connection signal="state_entered" from="State/Root/Charge/level1" to="State/Root/Charge/Charge States" method="_on_level_1_state_entered"]
[connection signal="state_entered" from="State/Root/Charge/level2" to="State/Root/Charge/Charge States" method="_on_level_2_state_entered"]
[connection signal="state_entered" from="State/Root/Charge/level3" to="State/Root/Charge/Charge States" method="_on_level_3_state_entered"]
[connection signal="state_exited" from="State/Root/Charge/level3" to="State/Root/Charge/Charge States" method="_on_level_3_state_exited"]
